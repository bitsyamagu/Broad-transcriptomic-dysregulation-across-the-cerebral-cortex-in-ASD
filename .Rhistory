options(stringsAsFactors = FALSE)
wkdir="C:/Users/jillh/Dropbox/GitHub/"
setwd(paste(wkdir,"Transcriptomic-changes-are-pervasive-across-11-cortical-regions-in-ASD/",sep=""))
library(limma); library(edgeR); library(cqn); library(biomaRt)
library(WGCNA); library(devtools); library(paralell)
library(ggplot2); library(gridExtra); library(variancePartition)
library(doParallel); library(lmerTest)
library(earth)
load("data_provided/02_DEGenesIsoforms/02_01_A_01_AllProcessedData_wModelMatrix.RData")
genes = substr(rownames(datExpr),1,15)
rm(datExpr,datMeta,datMeta_model,datSeq,datSeq_numeric,topPC,rsem_gene_effLen)
load("data_provided/01_RNAseqProcessing/01_02_B_01_RawData.RData")
cpm <- apply(rsem_tx,2, function(x) (x/sum(x))*1000000)
keep = apply(cpm>0.1,1,sum)
rm(list=ls())
ls()
list.files()_
list.files()
list.files("data_provided/")
list.files("data_provided/02_DEGenesIsoforms/")
load("data_provided/02_DEGenesIsoforms/02_01_A_01_AllProcessedData_wModelMatrix.RData")
load("data_provided/02_DEGenesIsoforms/02_01_A_AllProcessedData_wModelMatrix.RData")
genes = substr(rownames(datExpr),1,15)
rm(datExpr,datMeta,datMeta_model,datSeq,datSeq_numeric,topPC,rsem_gene_effLen)
load("data_provided/01_RNAseqProcessing/01_02_B_01_RawData.RData")
cpm <- apply(rsem_tx,2, function(x) (x/sum(x))*1000000)
keep = apply(cpm>0.1,1,sum)
idx = which(keep > 0.3*dim(cpm)[2]) ## cpm > 0.1 in 30% of samples
cpm = cpm[idx,]
length=rsem_transcript_effLen[match(rownames(cpm),names(rsem_transcript_effLen))]
idx = which(length <= 15)
short_remove = rownames(cpm)[idx]
idx_remove = match(short_remove,rownames(cpm))
cpm = cpm[-idx_remove,]
getinfo <- c("ensembl_transcript_id","ensembl_gene_id","hgnc_symbol","chromosome_name","start_position",
"end_position","strand","band","gene_biotype","percentage_gene_gc_content")
mart <- useMart(biomart="ENSEMBL_MART_ENSEMBL",
dataset="hsapiens_gene_ensembl",
host="http://apr2018.archive.ensembl.org")
geneAnno <- getBM(attributes = getinfo,filters=c("ensembl_transcript_id"),
values=substr(rownames(cpm),1,15),mart=mart)
isos_keep = rownames(cpm)[which(substr(rownames(cpm),1,15) %in% geneAnno$ensembl_transcript_id)]
dim(cpm)
head(rownames(cpm))
head(substr(rownames(cpm),1,15))
match_genes = geneAnno$ensembl_gene_id[match(substr(isos_keep,1,15),geneAnno$ensembl_transcript_id)]
head(match_genes)
isos_keep = isos_keep[which(match_genes %in% genes)]
head(isos_keep)
head(rownames(rsem_tx))
rsem_tx = rsem_tx[match(isos_keep,rownames(rsem_tx)),]
head(names(rsem_transcript_effLen))
rsem_transcript_effLen=rsem_transcript_effLen[match(isos_keep,names(rsem_transcript_effLen))]
head(rsem_transcript_effLen)
View(geneAnno)
head(isos_keep)
